#!/usr/bin/perl -w

use strict;
use File::Basename;

my $mutt_file = "$ENV{HOME}/.mutt/personal";
my $me = basename $0;

unless (@ARGV == 3) {
  die <<EOF;
Usage: $me <list short name> <list-addr> <longer description>

e.g. $me mercurial %s\@selenic.com '%s mailing list'

Short name gets used as folder name and \@adamspiers.org prefix.
Longer description gets used as mutt alias description text.
Can include '%s' in address and longer description which expands to short name.
EOF
}

my ($short, $addr, $longer) = @ARGV;

$addr =~ s/%s/$short/g;
$longer =~ s/%s/$short/g;
(my $regexp = $addr) =~ s/\@/.*/;
my $folder = $short;

open(CONFIG, ">>$mutt_file")
  or die "Couldn't append to $mutt_file: $!";

my $new_stuff = <<EOTEMPLATE;

alias $short "$longer" <$addr>
fcc-save-hook "$regexp" =lists/$short
subscribe $addr
#mailboxes =inboxes/$short
send-hook "$regexp" 'my_hdr From: "Adam Spiers" <$short\@adamspiers.org>'
send-hook "$regexp" 'my_hdr Reply-To: "Adam Spiers" <$short\@adamspiers.org>'
folder-hook =(inboxes|lists)/$short source ~/.mutt/mailing-list
EOTEMPLATE

print "Adding to $mutt_file:\n$new_stuff";
print CONFIG $new_stuff;

close(CONFIG);
