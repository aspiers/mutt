#!/usr/bin/perl -w

use strict;

my $mutt_file = "$ENV{HOME}/.mutt/personal";

unless (@ARGV == 3) {
  die <<'EOF';
Usage: $0 <list short name> <list-addr> <list description>

Short name gets used as folder name and @adamspiers.org prefix.
Long name gets used as alias description text.
Can include '%s' in long name which expands to short name.
EOF
}

my ($short, $addr, $long) = @ARGV;

$addr =~ s/%s/$short/g;
(my $regexp = $addr) =~ s/\@/.*/;
my $folder = $short;

open(CONFIG, ">>$mutt_file")
  or die "Couldn't append to $mutt_file: $!";

my $new_stuff = <<EOTEMPLATE;
alias $short "$long" <$addr>
fcc-save-hook "$regexp" =lists/$short
subscribe $addr
#mailboxes =inboxes/$short
send-hook "$regexp" 'my_hdr From: "Adam Spiers" <$short\@adamspiers.org>'
send-hook "$regexp" 'my_hdr Reply-To: "Adam Spiers" <$short\@adamspiers.org>'
folder-hook =(inboxes|lists)/$short source ~/.mutt/mailing-list
EOTEMPLATE

print "Adding to $mutt_file:\n$new_stuff";
print CONFIG $new_stuff;

close(CONFIG);
